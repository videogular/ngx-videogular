{"version":3,"file":"vg-cue-points.directive.js","sourceRoot":"","sources":["../../../../../../../../libs/ngx-videogular/core/src/lib/directives/vg-cue-points/vg-cue-points.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Directive,\n  OnInit,\n  OnDestroy,\n  DoCheck,\n  Output,\n  EventEmitter,\n  ElementRef,\n} from '@angular/core';\nimport { Subscription, Observable, fromEvent } from 'rxjs';\nimport { VgEvents } from '../../services/events/vg-events.service';\n\n@Directive({\n  selector: '[vgCuePoints]',\n})\nexport class VgCuePointsDirective implements OnInit, OnDestroy, DoCheck {\n  @Output() onEnterCuePoint: EventEmitter<any> = new EventEmitter();\n  @Output() onUpdateCuePoint: EventEmitter<any> = new EventEmitter();\n  @Output() onExitCuePoint: EventEmitter<any> = new EventEmitter();\n  @Output() onCompleteCuePoint: EventEmitter<any> = new EventEmitter();\n\n  subscriptions: Subscription[] = [];\n  cuesSubscriptions: Subscription[] = [];\n\n  onLoad$: Observable<any>;\n  onEnter$: Observable<any>;\n  onExit$: Observable<any>;\n\n  totalCues = 0;\n\n  constructor(public ref: ElementRef) {}\n\n  ngOnInit() {\n    this.onLoad$ = fromEvent(this.ref.nativeElement, VgEvents.VG_LOAD);\n    this.subscriptions.push(this.onLoad$.subscribe(this.onLoad.bind(this)));\n  }\n\n  onLoad(event: any) {\n    const cues: TextTrackCue[] = event.target.track.cues;\n\n    this.ref.nativeElement.cues = cues;\n\n    this.updateCuePoints(cues);\n  }\n\n  updateCuePoints(cues: TextTrackCue[]) {\n    this.cuesSubscriptions.forEach((s) => s.unsubscribe());\n\n    for (let i = 0, l = cues.length; i < l; i++) {\n      this.onEnter$ = fromEvent(cues[i], VgEvents.VG_ENTER);\n      this.cuesSubscriptions.push(\n        this.onEnter$.subscribe(this.onEnter.bind(this))\n      );\n\n      this.onExit$ = fromEvent(cues[i], VgEvents.VG_EXIT);\n      this.cuesSubscriptions.push(\n        this.onExit$.subscribe(this.onExit.bind(this))\n      );\n    }\n  }\n\n  onEnter(event: any) {\n    this.onEnterCuePoint.emit(event.target);\n  }\n\n  onExit(event: any) {\n    this.onExitCuePoint.emit(event.target);\n  }\n\n  ngDoCheck() {\n    if (this.ref.nativeElement.track && this.ref.nativeElement.track.cues) {\n      const changes =\n        this.totalCues !== this.ref.nativeElement.track.cues.length;\n\n      if (changes) {\n        this.totalCues = this.ref.nativeElement.track.cues.length;\n        this.ref.nativeElement.cues = this.ref.nativeElement.track.cues;\n        this.updateCuePoints(this.ref.nativeElement.track.cues);\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    this.subscriptions.forEach((s) => s.unsubscribe());\n  }\n}\n"]}